# Auth0 Setup Instructions for Chrome Extension

## What Was Changed

The Chrome extension now uses the proper Chrome Identity API (`chrome.identity.launchWebAuthFlow`) for Google sign-in instead of opening tabs. This provides a more reliable and secure OAuth flow.

## Auth0 Dashboard Configuration Required

You need to add the Chrome extension's redirect URI to your Auth0 application settings.

### Step 1: Get Your Extension's Redirect URI

1. Load your extension in Chrome (chrome://extensions/)
2. Make sure Developer mode is enabled
3. Note your Extension ID (shown on the extension card)
4. Your redirect URI will be: `https://<EXTENSION-ID>.chromiumapp.org/`

For example, if your extension ID is `abcdefghijklmnopqrstuvwxyz123456`, your redirect URI would be:
```
https://abcdefghijklmnopqrstuvwxyz123456.chromiumapp.org/
```

**Alternative Method**: Check the extension's redirect URI programmatically:
- Open the extension popup
- Open browser console (F12)
- Run: `chrome.identity.getRedirectURL()`
- This will show your exact redirect URI

### Step 2: Add Redirect URI to Auth0

1. Go to [Auth0 Dashboard](https://manage.auth0.com/)
2. Navigate to **Applications** â†’ **Applications**
3. Select your application (the one with Client ID: `itttKkwDovKRteOJ9MZZPa21uNgfPuq0`)
4. Go to the **Settings** tab
5. Scroll down to **Allowed Callback URLs**
6. Add your Chrome extension redirect URI to the list:
   ```
   https://<YOUR-EXTENSION-ID>.chromiumapp.org/
   ```
   
   **Important**: 
   - Include the trailing slash `/`
   - If you have multiple callback URLs, separate them with commas
   - Example: `http://localhost:3000/callback, https://abcdefghijklmnopqrstuvwxyz123456.chromiumapp.org/`

7. Also add it to **Allowed Logout URLs** (optional, but recommended):
   ```
   https://<YOUR-EXTENSION-ID>.chromiumapp.org/
   ```

8. Scroll down and click **Save Changes**

### Step 3: Verify PKCE is Enabled

PKCE (Proof Key for Code Exchange) is automatically used by the extension for security. Make sure:

1. Your Auth0 application type is **Single Page Application** (not Regular Web Application)
2. PKCE is enabled (it should be by default for SPAs)

### Step 4: Test the Integration

1. Reload the Chrome extension after making changes
2. Click "Sign in with Google" in the extension popup
3. You should see a popup window (not a new tab) for Google authentication
4. After signing in, the popup should close and you should be signed in to the extension

## Troubleshooting

### Error: "redirect_uri_mismatch"
- **Cause**: The redirect URI in Auth0 doesn't match your extension's redirect URI
- **Fix**: Double-check the extension ID and ensure the exact redirect URI is added to Auth0 (including trailing slash)

### Error: "invalid_client"
- **Cause**: Client ID mismatch or incorrect application type
- **Fix**: Verify the Client ID in `auth.js` matches your Auth0 application

### Popup doesn't open
- **Cause**: Missing `identity` permission in manifest.json
- **Fix**: Ensure `manifest.json` has `"identity"` and `"identity.email"` permissions

### Authentication succeeds but token isn't saved
- **Cause**: Background script may not be receiving the message
- **Fix**: Check browser console for errors, reload the extension

## Files Changed

1. `chrome-extension/manifest.json` - Added `identity` permissions
2. `chrome-extension/auth.js` - New file with PKCE OAuth logic
3. `chrome-extension/background.js` - Added Google auth handler
4. `chrome-extension/popup.js` - Updated to use Chrome Identity API

## Notes

- The extension now uses PKCE for security (no client secret needed)
- The redirect URI is automatically generated by Chrome based on your extension ID
- Each extension installation gets a unique redirect URI
- If you repackage/republish the extension, the Extension ID may change, requiring Auth0 update


